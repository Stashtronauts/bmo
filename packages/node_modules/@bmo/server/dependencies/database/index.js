import _ from 'lodash';
import uuid from 'uuid';
export default ({ db: { collections }, dependencies: { logger } }) => {
	const database = {};
	const collectionInterface = {};
	Object.keys(collections).map((key) => {
		console.log('Creating collection' + key);
		database[key] = [];
		collectionInterface[key] = {
			find: async (query) => {
				if (_.isEmpty(query)) {
					return _.map(database[key], (v) => v);
				}
				if (query.id) {
					return database[key][query.id];
				}
				return _.find(database[key], query);
			},
			create: async (model) => {
				const id = model.id = uuid.v4();
				console.log(model);
				database[key].push(model);
				database[key][id] = model;
				return model;
			},
			update: async (model) => {
				database[key][id] = model;
				return model;
			},
			delete: async (id) => {
				delete database[key][id];
			}
		};
	});
	console.log(collectionInterface);
	return collectionInterface;
};
